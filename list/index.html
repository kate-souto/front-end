<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <title>LOJS</title>
    <link rel="stylesheet" type="text/css" href="css/estilo.css" />
  </head>
  <body>
    <header>
      <h1>LOJS</h1>
    </header>
    <main>
        <div id="local">
        <input type='button' class="b" value='Gravar Lista' id="gravar">
        <input type='button' class="b" value='Recuperar Lista' id="recuperar">
        <input type='button' class="b" value='Limpar' id="limpar">
        </div>

        <br><br>
                    <label for="tarefa">Tarefa:</label><br>
                    <input type="text" name="tarefa" class="c" id="tarefa"><br><br>
                    <label for="inicio">Data de início:</label><br>
                    <input type="date" name="inicio" class="c" id="inicio"> <br><br>
                    <label for="fim">Data de fim:</label><br>
                    <input type="date" name="fim" class="c" id="fim"> <br><br>
                    <label for="funcionario">Funcionário:</label><br>
                    <input type="text" name="funcionario" class="c" id="funcionario"> <br><br>
        <input type='button' class="b" value='Adicionar Tarefa' id="adicionar"> <br><br >
      
        <section id="lista">LISTA DE TAREFAS</section>
    </main>

    <script>

      document.querySelector("#tarefa").addEventListener("input", verificar);
      document.querySelector("#funcionario").addEventListener("input", verificar);
      document.querySelector("#inicio").addEventListener("change", verificar);
      document.querySelector("#fim").addEventListener("change", verificar);
      document.querySelector("#adicionar").addEventListener("click", limparCampos);

      function verificar() {
        let tarefa = document.querySelector("#tarefa").value;
        let funcionario = document.querySelector("#funcionario").value;
        let inicio = document.querySelector("#inicio").value;
        let fim = document.querySelector("#fim").value;
        let adicionar = document.querySelector("#adicionar");

        if (  
          tarefa.trim().length > 0 &&
          funcionario.trim().length > 0 &&
          inicio &&
          fim &&
          new Date(inicio) <= new Date(fim)
        ) {
          adicionar.style.display = "block";
        } else {
          adicionar.style.display = "none";
        }
      }

      function limparCampos() {
        document.querySelector("#tarefa").value = "";
        document.querySelector("#funcionario").value = "";
        document.querySelector("#inicio").value = "";
        document.querySelector("#fim").value = "";

        document.querySelector("#adicionar").style.display = "none";
      }



      document.querySelector('#adicionar').addEventListener('click', insereTarefa);
      document.querySelector('#gravar').addEventListener('click', gravar);
      document.querySelector('#recuperar').addEventListener('click', recuperar);
      document.querySelector('#limpar').addEventListener('click', limpar);

      let toDoList=[]; //Variável com os dados da TODO list
      let toDoListOld=[];

      function mostra() {
        let valor = "";
        valor+=`<br>Tarefas a fazer<br>`
        for (let i = 0; i < toDoList.length; i++) {
          valor += `
          <input type="checkbox" id="tarefa${i}" onclick ="excluirTarefa(${i})">
          <label for="tarefa${i}"><br>Tarefa: ${toDoList[i].tarefa}<br> Data de início: ${toDoList[i].inicio}<br> Data de fim: ${toDoList[i].fim}<br> Funcionário: ${toDoList[i].funcionario}</label><br>`;
        }
        valor+=`<br>Tarefas feitas<br>`;
        for (let i = 0; i < toDoListOld.length; i++) {
          valor += `
          <input type="checkbox" id="tarefaOld${i}" onclick ="excluirTarefaOld(${i})">
          <label for="tarefaOld${i}"><br>Tarefa: ${toDoListOld[i].tarefa}<br> Data de início: ${toDoListOld[i].inicio}<br> Data de fim: ${toDoListOld[i].fim}<br> Funcionário: ${toDoListOld[i].funcionario}</label><br>`;
        }
        document.querySelector("#lista").innerHTML = valor;
      }

      // Inclui e exclui terefas no array toDoList
      function insereTarefa() {

        toDoList.push( 
        {    tarefa: document.querySelector("#tarefa").value,
             inicio: document.querySelector("#inicio").value,
             fim: document.querySelector("#fim").value,
             funcionario: document.querySelector("#funcionario").value
        }
          );
        mostra();
      }

      function excluirTarefa(num) {
        toDoListOld.push(toDoList[num]);
        toDoList.splice(num, 1);
        mostra();
      }

      function excluirTarefaOld(num) {
        toDoListOld.splice(num, 1);
        mostra();
      }

      //Operações no localstorage
      function gravar ()
      {
        localStorage.setItem("lista",JSON.stringify(toDoList));
        localStorage.setItem("listaOld",JSON.stringify(toDoListOld));
      }

      function recuperar ()
      {
        toDoList=[];
        lista=localStorage.getItem("lista");
        if(lista){
          toDoList=JSON.parse(lista);
        }
        toDoListOld=[];
        listaOld=localStorage.getItem("listaOld");
        if(listaOld){
          toDoListOld=JSON.parse(listaOld);
        }
        mostra();
      }
      function limpar() {
         localStorage.removeItem('lista');
         toDoList=[];
         localStorage.removeItem('listaOld');
         toDoListOld=[];
         mostra();
      } 
    </script>
  </body>
</html>
